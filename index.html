<!DOCTYPE html>
<html>
	<head>
		<title>Tamagotchi Pet</title>
		<link rel="stylesheet" type="text/css" href="stylesheet.css"/>
		<!-- App.js stylesheet -->
		<link rel="stylesheet" href="http://cdn.kik.com/app/1/default.css"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<script type="text/javascript" src="script.js"></script>
		<!-- Needed for Kik card functionality -->
		<script src="http://cdn.kik.com/kik/1.0.3/kik.js"></script>
		<!-- Kik's App.js library -->
	</head>
	<body>
		<!--<iframe id="mainframe" src="startPage.html"></iframe>-->
		<div class="app-page" data-page="creator">
			<div class="app-topbar">
				<div class="app-title">Build a Pet</div>
			</div>
			<div class="centered-div">
				<div class="title">Build your pet</div>
				<div>Choose some basic options to customize your pet.</div>
				<span id="error-message" style="color: red; font-weight: bold"></span>
				<br/>
				<table>
					<tr>
						<td>Pet Name:</td>
						<td><input type="text" placeholder="Your pet's name" class="app-input" id="pet-name"></input></td>
					</tr>
				</table>
				<script type="text/javascript">
					function create() {
						name = EbyID("pet-name").value;
						if(name == "") {
							error("Please enter a name.");
						} else if(!(/^[a-z0-9]*$/i.test(name))) {
							error("Only alphanumeric names. No spaces.");
						}
						/*localStorage.removeItem("pet");
						pet = [
							{"Health": 30},
							{"Hunger": 50},
							{"Happiness": 50},
							{"Weight": 50},
							{"Age": 0}
						];
						alert(pet);
						localStorage.setItem("pet", pet);*/
						localStorage.removeItem("petHealth");
						localStorage.setItem("petHealth", 30);
						localStorage.removeItem("petHunger");
						localStorage.setItem("petHunger", 30);
						localStorage.removeItem("petHappiness");
						localStorage.setItem("petHappiness", 30);
						localStorage.removeItem("petWeight");
						localStorage.setItem("petWeight", 30);
						localStorage.removeItem("petAge");
						localStorage.setItem("petAge", 30);

						localStorage.removeItem("petname");
						localStorage.setItem("petname", name);
						localStorage.removeItem("created");
						localStorage.setItem("created", true);
						loadPage("Pet");
					}
				</script>
				<table><tr>
					<td><div id="createButton" class="app-button">Create</div></td>
					<td style="padding-left: 20px;"><div id="cancel-create" class="app-button">Cancel</div></td>
				</tr></table>
			</div>
		</div>
		<div class="app-page" data-page="Pet">
			<div class="app-topbar">
				<table><tr>
					<td><div class="app-title">Pet</div></td>
					<td style="position: absolute; right: 100px;" class="topbar-icon"><img src="images/friendIconWhite.png"></img></td>
					<td style="position: absolute; right: 50px;" class="topbar-icon" style="padding-top: 0px;"><img src="images/stablesIconWhite.png"></img></td>
				</tr></table>
			</div>
			<br/>
			<br/>
			<br/>
			<br/>
			<br/>
			<center>
				<div id="image"></div>
				<span id="petname"></span>
			</center>
			<table id="pet-stats">
				<tr>
					<td>Health: </td>
					<td><div class="progressbar-back"><div class="progressbar-front" id="health-bar"></div></div></td>
				</tr>
			</table>

		</div>
		<div class="app-page" data-page="stable">
			<div class="app-topbar">
				<div class="app-title">Stables</div>
			</div>
		</div>

		<!-- App.js -->
		<script src="http://cdn.kik.com/app/1/app.js"></script>
		<!-- JQuery -->
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
		<!-- My code -->
		<script type="text/javascript">
			function tick() {
				//alert(document.getElementById("health-bar"));
				//alert(App.getStack()[App.getStack().length - 1]);
				if(getPageName() == "Pet") {
					updateProgressBar(document.getElementById("health-bar"), localStorage.getItem("petHealth"));
				}
				setTimeout(tick, 1000);
			}
			setTimeout(tick, 1000);
			App.populator("creator", function(page) {
				$(page)
					.find("#createButton")
					.on("click", function() {
						create();
					})
				$(page)
					.on("appShow", function() {
						if(localStorage.getItem("created") == null || localStorage.getItem("created") == false || localStorage.getItem("created") == "false") {
							EbyID("cancel-create").style.visibility = "hidden";
						} else {
							EbyID("cancel-create").style.visibility = "visible";
						}
					})
					$(page)
					.find("#cancel-create")
					.on("click", function() {
						App.back(function() {
							//Do nothing
						});
					});
				});
			App.populator("main", function(page) {
				//alert(document.getElementById("health-bar"));
			})
			$("#newpet")
				.on("click", function() {
					loadPage("Build a Pet");
				});
			App.populator("Pet", function(page) {
				$(page)
					.on("appShow", function() {
						EbyID("petname").innerHTML = localStorage.getItem("petname");
					})});
			if(localStorage.getItem("created") == null) {
				localStorage.setItem("created", false)
			}
			if(localStorage.getItem("created") == true || localStorage.getItem("created") == "true") {
				loadPage("Pet");
			} else {
				loadPage("creator");
			}
		</script>
	</body>
</html>